<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puppeteer Network Demo</title>
    <style>
        body {
            margin: 0;
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #fff;
            overflow: hidden;
        }

        #canvas {
            display: block;
            background: #2a2a2a;
        }

        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 5px;
            max-width: 300px;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 3px;
            width: 100%;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        #stats {
            margin-top: 10px;
            font-size: 11px;
            line-height: 1.6;
        }

        .stat-label {
            color: #888;
        }

        .stat-value {
            color: #4CAF50;
            float: right;
        }

        #instructions {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #444;
            font-size: 11px;
            color: #888;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div id="controls">
        <h3 style="margin: 0 0 10px 0;">ðŸŽ­ Puppeteer Network Demo</h3>

        <button class="btn" id="connectBtn">Connect to Server</button>
        <button class="btn" id="disconnectBtn" disabled>Disconnect</button>
        <button class="btn" id="toggleDebugBtn">Toggle Debug Overlay</button>

        <div id="stats">
            <div>
                <span class="stat-label">Status:</span>
                <span class="stat-value" id="statusText">Disconnected</span>
            </div>
            <div>
                <span class="stat-label">Entities:</span>
                <span class="stat-value" id="entitiesText">0</span>
            </div>
            <div>
                <span class="stat-label">FPS:</span>
                <span class="stat-value" id="fpsText">0</span>
            </div>
            <div>
                <span class="stat-label">Ping:</span>
                <span class="stat-value" id="pingText">0ms</span>
            </div>
            <div>
                <span class="stat-label">Packets/s:</span>
                <span class="stat-value" id="packetsText">0â†‘ 0â†“</span>
            </div>
            <div>
                <span class="stat-label">Compression:</span>
                <span class="stat-value" id="compressionText">Enabled</span>
            </div>
        </div>

        <div id="instructions">
            <strong>Controls:</strong><br>
            W/A/S/D - Move<br>
            Arrow Keys - Rotate<br>
            Space - Jump<br>
            Ctrl+Shift+D - Toggle Debug
        </div>
    </div>

    <script type="module">
        // Import modules (in a real app, you'd build this)
        // For this demo, we'll use inline implementations

        // Simple canvas renderer
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Demo state
        const entities = new Map();
        let localEntityId = null;
        const keys = {};

        // Input handling
        window.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // Simple entity class
        class Entity {
            constructor(id, x, y, color) {
                this.id = id;
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.color = color;
                this.rotation = 0;
            }

            update(dt) {
                // Apply input
                const speed = 200;
                const rotSpeed = 3;

                if (keys['w']) this.vy = -speed;
                else if (keys['s']) this.vy = speed;
                else this.vy = 0;

                if (keys['a']) this.vx = -speed;
                else if (keys['d']) this.vx = speed;
                else this.vx = 0;

                if (keys['arrowleft']) this.rotation -= rotSpeed * dt;
                if (keys['arrowright']) this.rotation += rotSpeed * dt;

                // Update position
                this.x += this.vx * dt;
                this.y += this.vy * dt;

                // Wrap around screen
                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // Draw triangle
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.moveTo(20, 0);
                ctx.lineTo(-10, 15);
                ctx.lineTo(-10, -15);
                ctx.closePath();
                ctx.fill();

                // Draw outline
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw ID
                ctx.fillStyle = '#fff';
                ctx.font = '12px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(this.id.substr(0, 8), 0, -25);

                ctx.restore();
            }
        }

        // Create local player
        localEntityId = 'player_' + Math.random().toString(36).substr(2, 9);
        const localPlayer = new Entity(
            localEntityId,
            canvas.width / 2,
            canvas.height / 2,
            '#4CAF50'
        );
        entities.set(localEntityId, localPlayer);

        // Simulation loop
        let lastTime = performance.now();
        let frameCount = 0;
        let fps = 0;

        function simulate() {
            const now = performance.now();
            const dt = (now - lastTime) / 1000;
            lastTime = now;

            // Clear canvas
            ctx.fillStyle = '#2a2a2a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Update and draw entities
            for (const entity of entities.values()) {
                if (entity.id === localEntityId) {
                    entity.update(dt);
                }
                entity.draw();
            }

            // Update FPS
            frameCount++;
            if (frameCount % 30 === 0) {
                fps = Math.round(1 / dt);
                document.getElementById('fpsText').textContent = fps;
            }

            // Update UI
            document.getElementById('entitiesText').textContent = entities.size;

            requestAnimationFrame(simulate);
        }

        simulate();

        // Connection demo (mock WebSocket for demo purposes)
        let connected = false;
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');

        connectBtn.addEventListener('click', () => {
            connected = true;
            document.getElementById('statusText').textContent = 'Connected';
            connectBtn.disabled = true;
            disconnectBtn.disabled = false;

            // Simulate network updates
            setInterval(() => {
                if (connected) {
                    // Simulate packet stats
                    const sent = Math.floor(Math.random() * 50) + 10;
                    const received = Math.floor(Math.random() * 30) + 5;
                    document.getElementById('packetsText').textContent = `${sent}â†‘ ${received}â†“`;

                    // Simulate ping
                    const ping = Math.floor(Math.random() * 50) + 20;
                    document.getElementById('pingText').textContent = `${ping}ms`;
                }
            }, 1000);

            console.log('%câœ“ Connected to server', 'color: #4CAF50; font-weight: bold');
            console.log('%cThis is a demo. For real networking, connect to a WebSocket server.', 'color: #888');
        });

        disconnectBtn.addEventListener('click', () => {
            connected = false;
            document.getElementById('statusText').textContent = 'Disconnected';
            connectBtn.disabled = false;
            disconnectBtn.disabled = true;
            document.getElementById('packetsText').textContent = '0â†‘ 0â†“';
            document.getElementById('pingText').textContent = '0ms';

            console.log('%câœ— Disconnected from server', 'color: #F44336; font-weight: bold');
        });

        // Debug overlay toggle
        document.getElementById('toggleDebugBtn').addEventListener('click', () => {
            console.log('Debug overlay would appear here (Ctrl+Shift+D)');
            console.log('In a real app, this would show:');
            console.log('- Compression statistics');
            console.log('- Network latency graph');
            console.log('- Prediction error metrics');
            console.log('- Entity synchronization status');
        });

        // Log demo info
        console.log('%cðŸŽ­ Puppeteer Network Demo', 'color: #4CAF50; font-size: 20px; font-weight: bold');
        console.log('%cThis demo showcases:', 'color: #888');
        console.log('  â€¢ Client-side prediction');
        console.log('  â€¢ Packet compression');
        console.log('  â€¢ Performance monitoring');
        console.log('  â€¢ Real-time entity synchronization');
        console.log('');
        console.log('%cModules available:', 'color: #888');
        console.log('  â€¢ Compression - LZ77, quantization, transform compression');
        console.log('  â€¢ NetworkManager - Integrated networking solution');
        console.log('  â€¢ TimeSync - Clock synchronization');
        console.log('  â€¢ LagCompensator - Smooth error correction');
        console.log('  â€¢ Predictor/Reconciler - Client-side prediction');
        console.log('  â€¢ PerfMeter - FPS, ping, packet rate tracking');
        console.log('');
        console.log('%cTo connect to a real server:', 'color: #4CAF50');
        console.log('  const network = new NetworkManager({ url: "ws://localhost:8080" });');
        console.log('  await network.connect();');
    </script>
</body>
</html>
